if (self.CavalryLogger) { CavalryLogger.start_js(["ZpKFI"]); }

__d("StoriesCometCardStatusSubscription.graphql",[],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:null,kind:"LocalArgument",name:"input",type:"StoryCardStatusSubscribeData!"}],b=[{kind:"Variable",name:"data",variableName:"input"}],c={alias:null,args:null,concreteType:"StoryCardStoryInfo",kind:"LinkedField",name:"story_card_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"thread_status",storageKey:null}],storageKey:null};return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"StoriesCometCardStatusSubscription",selections:[{alias:null,args:b,concreteType:"StoryCardStatusSubscribeResponsePayload",kind:"LinkedField",name:"story_card_status_subscribe",plural:!1,selections:[{alias:null,args:null,concreteType:"Story",kind:"LinkedField",name:"story",plural:!1,selections:[c],storageKey:null}],storageKey:null}],type:"Subscription",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"StoriesCometCardStatusSubscription",selections:[{alias:null,args:b,concreteType:"StoryCardStatusSubscribeResponsePayload",kind:"LinkedField",name:"story_card_status_subscribe",plural:!1,selections:[{alias:null,args:null,concreteType:"Story",kind:"LinkedField",name:"story",plural:!1,selections:[c,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}],storageKey:null}]},params:{id:"2776252045744354",metadata:{subscriptionName:"story_card_status_subscribe"},name:"StoriesCometCardStatusSubscription",operationKind:"subscription",text:null}}}();e.exports=a}),null);
__d("StoriesCreateMutation.graphql",[],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:null,kind:"LocalArgument",name:"input",type:"StoryCreateData!"}],b=[{alias:null,args:[{kind:"Variable",name:"data",variableName:"input"}],concreteType:"StoryCreateResponsePayload",kind:"LinkedField",name:"story_create",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"story_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"logging_token",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"StoriesCreateMutation",selections:b,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"StoriesCreateMutation",selections:b},params:{id:"3633519690051796",metadata:{},name:"StoriesCreateMutation",operationKind:"mutation",text:null}}}();e.exports=a}),null);
__d("CometSearchResultsStandaloneArticle.react",["CometSearchResultsArticle.react","React","cometSearchResultsWithCard"],(function(a,b,c,d,e,f){"use strict";b("React"),e.exports=b("cometSearchResultsWithCard")(b("CometSearchResultsArticle.react"))}),null);
__d("StoriesCometCardStatusSubscription",["CometRelay","StoriesCometCardStatusSubscription.graphql"],(function(a,b,c,d,e,f){"use strict";var g;b("CometRelay").graphql;var h=b("CometRelay").requestSubscription,i=g!==void 0?g:g=b("StoriesCometCardStatusSubscription.graphql");function a(a,b,c){b={input:b};return h(a,{onNext:c,subscription:i,variables:b})}e.exports={subscribe:a}}),null);
__d("StoriesCreateBlurredBgTransformer",["QuickPerformanceLogger"],(function(a,b,c,d,e,f){"use strict";function a(a,c,d){a=a==null?void 0:a.blurredBg;if(a==null||a.topColor==null||a.bottomColor==null){d(c);return}var e=c.canvas,f=c.qplEvent,g=e.getContext("2d");g.save();var h=g.createLinearGradient(0,0,e.width,e.height);a.topColor!=null&&h.addColorStop(0,a.topColor);a.bottomColor!=null&&h.addColorStop(1,a.bottomColor);g.fillStyle=h;g.fillRect(0,0,e.width,e.height);g.restore();f!=null&&b("QuickPerformanceLogger").markerPoint(f,"blurred background drawn to canvas");d(c)}e.exports=a}),null);
__d("StoriesCreateCTALinkTransformer",[],(function(a,b,c,d,e,f){"use strict";function a(a,b,c){var d;if(((d=a.formData)==null?void 0:d.mediaType)!=="photo"&&((d=a.formData)==null?void 0:d.mediaType)!=="video"||((d=a.ctaLinkData)==null?void 0:d.ctaType)==null||((d=a.ctaLinkData)==null?void 0:d.link)==null){c(b);return}c(babelHelpers["extends"]({},b,{call_to_action_data:{is_cta_share_post:!0,link:a.ctaLinkData.link,type:a.ctaLinkData.ctaType}}))}e.exports=a}),null);
__d("StoriesCreatePhotoTransformer",["FBLogger","QuickPerformanceLogger"],(function(a,b,c,d,e,f){"use strict";function a(a,c,d){a=a==null?void 0:a.photoData;if(a==null){d(c);return}var e=a.displayedURI,f=a.dest,g=a.rotation;if(e==null){d(c);return}var h=c.canvas,i=c.qplEvent,j=h.width,k=h.height;a=g%180!==0?[k,j]:[j,k];var l=a[0],m=a[1],n=new Image();n.crossOrigin="Anonymous";n.onerror=function(){var a="Failed to load image: "+e;b("FBLogger")("fbstories").warn(a);c.onTransformError(a)};n.onload=function(){var a=h.getContext("2d"),e=f.x*l,o=f.y*m,p=f.width*l,q=f.height*m;a.save();a.translate(j/2,k/2);a.rotate(g*Math.PI/180);a.translate(-l/2,-m/2);a.drawImage(n,0,0,n.width,n.height,e,o,p,q);a.restore();i!=null&&b("QuickPerformanceLogger").markerPoint(i,"photo drawn to canvas");d(c)};n.src=e}e.exports=a}),null);
/**
 * License: https://www.facebook.com/legal/license/MDzNl_j9yvg/
 */
__d("blueimp-canvas-to-blob-3.14.0",[],(function(a,b,c,d,e,f){"use strict";a={};var g={exports:a},h;function i(){(function(a){var b=a.HTMLCanvasElement&&a.HTMLCanvasElement.prototype,c=a.Blob&&function(){try{return Boolean(new Blob())}catch(a){return!1}}(),d=c&&a.Uint8Array&&function(){try{return new Blob([new Uint8Array(100)]).size===100}catch(a){return!1}}(),e=a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder||a.MSBlobBuilder,f=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,i=(c||e)&&a.atob&&a.ArrayBuffer&&a.Uint8Array&&function(a){var b,g,h,i;b=a.match(f);if(!b)throw new Error("invalid data URI");g=b[2]?b[1]:"text/plain"+(b[3]||";charset=US-ASCII");h=!!b[4];a=a.slice(b[0].length);h?b=atob(a):b=decodeURIComponent(a);h=new ArrayBuffer(b.length);a=new Uint8Array(h);for(i=0;i<b.length;i+=1)a[i]=b.charCodeAt(i);if(c)return new Blob([d?a:h],{type:g});b=new e();b.append(h);return b.getBlob(g)};a.HTMLCanvasElement&&!b.toBlob&&(b.mozGetAsFile?b.toBlob=function(a,c,d){var e=this;setTimeout(function(){d&&b.toDataURL&&i?a(i(e.toDataURL(c,d))):a(e.mozGetAsFile("blob",c))})}:b.toDataURL&&i&&(b.toBlob=function(a,b,c){var d=this;setTimeout(function(){a(i(d.toDataURL(b,c)))})}));typeof h==="function"&&h.amd?h(function(){return i}):typeof g==="object"&&g.exports?g.exports=i:a.dataURLtoBlob=i})(window)}var j=!1,k=function(){j||(j=!0,i());return g.exports};b=function(a){switch(a){case void 0:return k()}};e.exports=b}),null);
__d("blueimp-canvas-to-blob",["blueimp-canvas-to-blob-3.14.0"],(function(a,b,c,d,e,f){e.exports=b("blueimp-canvas-to-blob-3.14.0")()}),null);
__d("StoriesCreatePhotoUploadTransformer",["ComposerMediaFileUploader","QuickPerformanceLogger","cometComposerMediaUploadLogger","blueimp-canvas-to-blob","MediaUploadFailureFalcoEvent","cometUniqueID"],(function(a,b,c,d,e,f){"use strict";b("blueimp-canvas-to-blob");function a(a,c,d){var e,f=a==null?void 0:(e=a.mediaAttachments)==null?void 0:e[0];e=c.audiences;var g=c.canvas,h=c.qplEvent,i=c.videoUploaderConfig,j=e==null?void 0:(e=e[0])==null?void 0:(e=e.stories)==null?void 0:(e=e.self)==null?void 0:e.target_id;if((f==null?void 0:f.fileType)!=="PHOTO"||j==null){d(c);return}g.toBlob(function(e){var g=b("ComposerMediaFileUploader").createOrGetInstance(j,i),k=e,l=b("cometUniqueID")();k.uploadID=l;b("cometComposerMediaUploadLogger")({fields:{media_id:l,media_type:"PHOTO"},type:"MEDIA_UPLOAD_START"},a.composerSessionID);g.successObserver.subscribe(function(e){e.uploadID===k.uploadID&&(b("cometComposerMediaUploadLogger")({fields:{media_id:l,media_type:"PHOTO"},type:"MEDIA_UPLOAD_SUCCESS"},a.composerSessionID),h!=null&&b("QuickPerformanceLogger").markerPoint(h,"photo uploaded"),d(babelHelpers["extends"]({},c,{attachments:[{photo:{id:e.entID}}]})))});g.errorObserver.subscribe(function(d){d.uploadID===k.uploadID&&(b("MediaUploadFailureFalcoEvent").log(function(){return{creation_session_id:a.composerSessionID,error_info:d.error}}),c.onTransformError(d.error))});g.upload([[k,f.fileType]])},"image/jpeg")}e.exports=a}),null);
__d("StoriesCreateSATPTransformer",["unrecoverableViolation"],(function(a,b,c,d,e,f){"use strict";function a(a,c,d){var e;if(((e=a.formData)==null?void 0:e.mediaType)!=="satp"){d(c);return}e=a==null?void 0:a.satpData;if(e==null)throw b("unrecoverableViolation")("Stories Create mutation SATP Data should not be null/undefined","fb_stories_web");d(babelHelpers["extends"]({},c,{message:{ranges:[],text:e.text},text_format_metadata:{inspirations_custom_font_id:e.fontID},text_format_preset_id:e.presetID}))}e.exports=a}),null);
__d("StoriesCreateTextOverlayTransformer",["FBLogger","JSResourceForInteraction","QuickPerformanceLogger","promiseDone"],(function(a,b,c,d,e,f){"use strict";var g=b("JSResourceForInteraction")("html2canvas-v1.0-rc_1",{"class":"fluid",name:"StoriesCreate.textoverlay",oncall:"fb_stories_web"}).__setRef("StoriesCreateTextOverlayTransformer"),h=4;function a(a,c,d){if(a.textOverlays==null||a.textOverlays.overlays.length===0){d(c);return}var e=c.clonedTextOverlayNode;if(e==null){b("FBLogger")("fbstories").warn("Text overlay transformer missing cloned node");d(c);return}var f=c.canvas,i=f.getContext("2d");b("promiseDone")(g.load(),function(a){var g=document.body;if(g==null){b("FBLogger")("fbstories").warn("Text overlay transformer missing document body");d(c);return}g.appendChild(e);b("promiseDone")(a(e,{allowTaint:!0,backgroundColor:"rgba(0,0,0,0)",scale:h}).then(function(a){i.drawImage(a,0,0,f.width,f.height),e.remove(),c.qplEvent!=null&&b("QuickPerformanceLogger").markerPoint(c.qplEvent,"text overlays added"),d(c)}))})}e.exports=a}),null);
__d("reduceStoriesCreateViewStateToCreationData",["gkx"],(function(a,b,c,d,e,f){"use strict";function a(a){var b=window.open("about:blank","image from canvas");b!=null&&b.document.write("<img src='"+a+"' alt='from canvas'/>")}function b(a,b,c,d){function e(c,f){var g=b[f];if(g!=null){var h=function(a){e(a,f+1)};g(a,c,h)}else{g=c.canvas;c.clonedTextOverlayNode;c.onTransformError;c.qplEvent;c.videoUploaderConfig;h=babelHelpers.objectWithoutPropertiesLoose(c,["canvas","clonedTextOverlayNode","onTransformError","qplEvent","videoUploaderConfig"]);d(h)}}e(c,0)}e.exports=b}),null);
__d("storiesUploadUpdater",["CometRelay","uuid"],(function(a,b,c,d,e,f){"use strict";var g=b("CometRelay").ConnectionHandler;function h(a){var c=b("uuid")(),d=a.create("client:newNode:"+c,"Story");a=a.create(b("uuid")(),"StoryCardStoryInfo");a.setValue("PENDING","thread_status");d.setValue(c,"id");d.setLinkedRecord(a,"story_card_info");return d}function i(a){var c=a.create("client:newNode:"+b("uuid")(),"UnifiedStoryBucketToUnifiedStoriesConnection"),d=h(a);a=g.createEdge(a,c,d,"UnifiedStoryBucketToUnifiedStoriesEdge");g.insertEdgeBefore(c,a);return c}function j(a,c){var d=b("uuid")(),e=a.create("client:newNode:"+d,"StoryBucket");e.setLinkedRecord(c,"story_bucket_owner");c=i(a);e.setLinkedRecord(c,"unified_stories");e.setValue(d,"id");return e}a=function(a,b){b=a.get(b);if(!b)return;var c=b.getOrCreateLinkedRecord("unified_stories_buckets","UserToUnifiedStoryBucketsConnection",{find:"loading",first:1});if(c){b=j(a,b);a=g.createEdge(a,c,b,"UserToUnifiedStoryBucketsEdge");a&&g.insertEdgeAfter(c,a)}};e.exports=a}),null);
__d("StoriesCreateMutation",["CometRelay","QuickPerformanceLogger","StoriesCometCardStatusSubscription","StoriesCreateBlurredBgTransformer","StoriesCreateCTALinkTransformer","StoriesCreatePhotoTransformer","StoriesCreatePhotoUploadTransformer","StoriesCreateSATPTransformer","StoriesCreateTextOverlayTransformer","cometComposerLogger","getComposerLoggingPayload","reduceStoriesCreateViewStateToCreationData","storiesUploadUpdater","StoriesCreateMutation.graphql"],(function(a,b,c,d,e,f){"use strict";var g,h=b("CometRelay").applyOptimisticMutation,i=b("CometRelay").commitMutation;b("CometRelay").graphql;var j=b("getComposerLoggingPayload").getStoriesComposerLoggingPayload,k=[b("StoriesCreateSATPTransformer"),b("StoriesCreateBlurredBgTransformer"),b("StoriesCreatePhotoTransformer"),b("StoriesCreateTextOverlayTransformer"),b("StoriesCreateCTALinkTransformer"),b("StoriesCreatePhotoUploadTransformer")],l=g!==void 0?g:g=b("StoriesCreateMutation.graphql");function a(a,c,d,e,f,g,h,n){var o=j(a);b("cometComposerLogger")({fields:{composerType:"stories",payload:o},type:"COMPOSER_POST"},a.composerSessionID);o=document.createElement("canvas");var p=null,q=b("StoriesCometCardStatusSubscription").subscribe(d,{send_key:a.composerSessionID},function(c){c=c==null?void 0:(c=c.story_card_status_subscribe)==null?void 0:(c=c.story)==null?void 0:(c=c.story_card_info)==null?void 0:c.thread_status;(c==="PUBLISHED"||c==="FAILED")&&(c==="PUBLISHED"?(b("cometComposerLogger")({fields:{destination:"stories"},type:"COMPOSER_POST_SERVER_CONTENT_RENDERED"},a.composerSessionID),g!=null&&b("QuickPerformanceLogger").markerEnd(g,2)):g!=null&&b("QuickPerformanceLogger").markerEnd(g,3),p&&p.dispose(),q.dispose())}),r=function(a){var c=new Error();a!=null&&(c.description=a.toString());g!=null&&b("QuickPerformanceLogger").markerEnd(g,3);h(c);p&&p.dispose();q.dispose()};p=m(d,{audiences:[{stories:{self:{target_id:c}}}],source:"WWW"},c);o.height=1920;o.width=1080;b("reduceStoriesCreateViewStateToCreationData")(a,k,{audiences:[{stories:{self:{target_id:c}}}],canvas:o,clonedTextOverlayNode:f,logging:{composer_session_id:a.composerSessionID},onTransformError:r,qplEvent:g,source:"WWW",videoUploaderConfig:e},function(c){b("cometComposerLogger")({fields:{destination:"stories"},type:"COMPOSER_POST_MUTATION_START"},a.composerSessionID),i(d,{mutation:l,onCompleted:function(c){b("cometComposerLogger")({fields:{composerType:"stories",loggingIds:(c=c.story_create)==null?void 0:c.logging_token},type:"COMPOSER_POST_SUCCESS"},a.composerSessionID);p&&p.dispose();n()},onError:function(c){var d;b("cometComposerLogger")({fields:{composerType:"stories",errorDescription:typeof c.description==="string"?c.description:(d=c.description)==null?void 0:d.toString(),errorInfo:c.message},type:"COMPOSER_POST_FAILURE"},a.composerSessionID);p&&p.dispose();q&&q.dispose();h(c)},variables:{input:babelHelpers["extends"]({},c)}})})}function m(a,c,d){var e=h(a,{mutation:l,optimisticUpdater:function(a){b("storiesUploadUpdater")(a,d)},variables:{input:babelHelpers["extends"]({},c)}});return{dispose:function(){e&&e.dispose(),e=null}}}e.exports={createStories:a}}),null);